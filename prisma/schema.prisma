generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                        String                   @id @default(cuid())
  email                     String                   @unique
  emailVerified             DateTime?
  passwordHash              String?
  firstName                 String
  lastName                  String
  phone                     String?
  role                      UserRole
  status                    UserStatus               @default(PENDING)
  profileImageUrl           Json?
  twoFactorEnabled          Boolean                  @default(false)
  twoFactorSecret           String?
  backupCodes               Json?
  verificationToken         String?
  verificationTokenExpiry   DateTime?
  resetPasswordToken        String?
  resetPasswordTokenExpiry  DateTime?
  notificationPrefs         Json?
  preferences               Json?
  timezone                  String                   @default("UTC")
  createdAt                 DateTime                 @default(now())
  updatedAt                 DateTime                 @updatedAt
  lastLoginAt               DateTime?
  activities                ActivityFeedItem[]       @relation("ActivityActor")
  addresses                 Address[]
  affiliate                 Affiliate?
  createdAppointments       Appointment[]
  appointmentParticipations AppointmentParticipant[]
  actionedAuditLogs         AuditLog[]               @relation("ActionedByUser")
  auditLogs                 AuditLog[]               @relation("UserAuditLogs")
  availabilitySlots         AvailabilitySlot[]
  caregiver                 Caregiver?
  reviewedDocuments         Document[]               @relation("DocumentReviewer")
  documentsUploaded         Document[]               @relation("UploadedDocuments")
  documentComments          DocumentComment[]        @relation("DocumentCommentAuthor")
  family                    Family?
  uploadedDocuments         FamilyDocument[]         @relation("DocumentUploader")
  invitedFamilyMembers      FamilyMember[]           @relation("InvitedBy")
  familyMembers             FamilyMember[]
  authoredNotes             FamilyNote[]             @relation("NoteAuthor")
  uploadedPhotos            GalleryPhoto[]           @relation("PhotoUploader")
  assignedInquiries         Inquiry[]                @relation("AssignedInquiries")
  convertedInquiries        Inquiry[]                @relation("InquiryConverter")
  uploadedInquiryDocuments  InquiryDocument[]        @relation("InquiryDocumentUploader")
  assignedLeads             Lead[]                   @relation("AssignedLeads")
  marketplaceListings       MarketplaceListing[]     @relation("UserListings")
  matchFeedback             MatchFeedback[]
  receivedMessages          Message[]                @relation("MessageReceiver")
  messages                  Message[]                @relation("MessageSender")
  noteComments              NoteComment[]            @relation("NoteCommentAuthor")
  notifications             Notification[]
  operator                  Operator?
  payments                  Payment[]
  provider                  Provider?
  generatedReports          Report[]                 @relation("ReportGenerator")
  uploadedResidentDocuments ResidentDocument[]       @relation("ResidentDocumentUploader")
  createdResidentNotes      ResidentNote[]
  scheduledNotifications    ScheduledNotification[]
  scheduledReports          ScheduledReport[]        @relation("ScheduledReportCreator")
  sessions                  Session[]
  createdGalleries          SharedGallery[]          @relation("GalleryCreator")
  approvedTimesheets        Timesheet[]
  placementSearches         PlacementSearch[]

  @@index([email])
  @@index([role])
  @@index([status])
  @@index([verificationToken])
  @@index([resetPasswordToken])
  @@index([firstName])
  @@index([lastName])
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  expires      DateTime
  sessionToken String   @unique
  accessToken  String?  @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  ipAddress    String?
  userAgent    String?
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Family {
  id                      String                @id @default(cuid())
  userId                  String                @unique
  emergencyContact        String?
  emergencyPhone          String?
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  careNotes               String?
  mobilityLevel           String?
  phone                   String?
  primaryContactName      String?
  primaryDiagnosis        String?
  recipientAge            Int?
  relationshipToRecipient String?
  activities              ActivityFeedItem[]
  bookings                Booking[]
  emergencyPreferences    EmergencyPreference[]
  user                    User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  documents               FamilyDocument[]
  members                 FamilyMember[]
  notes                   FamilyNote[]
  wallet                  FamilyWallet?
  caregiverShortlists     FavoriteCaregiver[]
  favorites               FavoriteHome[]
  providerShortlists      FavoriteProvider[]
  inquiries               Inquiry[]
  leads                   Lead[]
  matchRequests           MatchRequest[]
  residents               Resident[]
  galleries               SharedGallery[]
  tourRequests            TourRequest[]

  @@index([userId])
}

model Operator {
  id              String                @id @default(cuid())
  userId          String                @unique
  companyName     String
  taxId           String?
  businessLicense String?
  preferences     Json?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  homes           AssistedLivingHome[]
  caregivers      CaregiverEmployment[]
  user            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  tourRequests    TourRequest[]

  @@index([userId])
  @@index([companyName])
}

model Caregiver {
  id                       String                   @id @default(cuid())
  userId                   String                   @unique
  bio                      String?
  yearsExperience          Int?
  hourlyRate               Decimal?                 @db.Decimal(10, 2)
  availability             Json?
  backgroundCheckStatus    BackgroundCheckStatus    @default(NOT_STARTED)
  backgroundCheckProvider  String?
  backgroundCheckReportUrl String?
  specialties              String[]
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  careTypes                String[]                 @default([])
  settings                 String[]                 @default([])
  /// Whether the caregiver profile is visible in the public marketplace search
  isVisibleInMarketplace   Boolean                  @default(true)
  languages                String[]                 @default([])
  employmentType           EmploymentType?
  employmentStatus         EmploymentStatus?        @default(ACTIVE)
  hireDate                 DateTime?
  photoUrl                 String?
  user                     User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  assignments              CaregiverAssignment[]
  certifications           CaregiverCertification[]
  documents                CaregiverDocument[]
  employments              CaregiverEmployment[]
  reviews                  CaregiverReview[]
  shifts                   CaregiverShift[]
  credentials              Credential[]
  shortlistedByFamilies    FavoriteCaregiver[]
  favoriteListings         FavoriteListing[]
  leads                    Lead[]                   @relation("LeadToAide")
  marketplaceApplications  MarketplaceApplication[]
  marketplaceHires         MarketplaceHire[]
  timesheets               Timesheet[]

  @@index([userId])
  @@index([hourlyRate])
  @@index([yearsExperience])
  @@index([createdAt])
  @@index([isVisibleInMarketplace])
  @@index([employmentStatus])
  @@index([employmentType])
}

model Affiliate {
  id             String              @id @default(cuid())
  userId         String              @unique
  affiliateCode  String              @unique
  organization   String?
  commissionRate Decimal?            @db.Decimal(5, 2)
  paymentDetails Json?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  referrals      AffiliateReferral[]

  @@index([userId])
  @@index([affiliateCode])
}

model CaregiverCertification {
  id                  String              @id @default(cuid())
  caregiverId         String
  certificationType   CertificationType
  certificationName   String?
  issueDate           DateTime
  expiryDate          DateTime?
  certificationNumber String?
  issuingOrganization String?
  documentUrl         String?
  status              CertificationStatus @default(CURRENT)
  notes               String?
  verifiedBy          String?
  verifiedAt          DateTime?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  caregiver           Caregiver           @relation(fields: [caregiverId], references: [id], onDelete: Cascade)

  @@index([caregiverId])
  @@index([status])
  @@index([expiryDate])
  @@index([certificationType])
}

model CaregiverAssignment {
  id          String    @id @default(cuid())
  caregiverId String
  residentId  String
  isPrimary   Boolean   @default(false)
  startDate   DateTime
  endDate     DateTime?
  notes       String?
  assignedBy  String?
  assignedAt  DateTime  @default(now())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  caregiver   Caregiver @relation(fields: [caregiverId], references: [id], onDelete: Cascade)
  resident    Resident  @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@index([caregiverId])
  @@index([residentId])
  @@index([isPrimary])
  @@index([startDate])
  @@index([endDate])
}

model CaregiverDocument {
  id           String                @id @default(cuid())
  caregiverId  String
  documentType CaregiverDocumentType
  title        String
  description  String?
  documentUrl  String
  uploadDate   DateTime              @default(now())
  expiryDate   DateTime?
  uploadedBy   String?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  caregiver    Caregiver             @relation(fields: [caregiverId], references: [id], onDelete: Cascade)

  @@index([caregiverId])
  @@index([documentType])
  @@index([expiryDate])
  @@index([uploadDate])
}

model Provider {
  id                    String               @id @default(cuid())
  userId                String               @unique
  businessName          String
  contactName           String
  contactEmail          String
  contactPhone          String?
  bio                   String?
  website               String?
  insuranceInfo         String?
  licenseNumber         String?
  yearsInBusiness       Int?
  isVerified            Boolean              @default(false)
  isActive              Boolean              @default(true)
  serviceTypes          String[]
  coverageArea          Json?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  shortlistedByFamilies FavoriteProvider[]
  leads                 Lead[]               @relation("LeadToProvider")
  user                  User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  credentials           ProviderCredential[]

  @@index([userId])
  @@index([businessName])
  @@index([isVerified])
  @@index([isActive])
  @@index([serviceTypes])
  @@index([createdAt])
}

model ProviderCredential {
  id          String           @id @default(cuid())
  providerId  String
  type        String
  documentUrl String?
  status      CredentialStatus @default(PENDING)
  verifiedAt  DateTime?
  verifiedBy  String?
  expiresAt   DateTime?
  notes       String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  provider    Provider         @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([type])
  @@index([status])
  @@index([expiresAt])
}

model AssistedLivingHome {
  id                     String           @id @default(cuid())
  operatorId             String
  name                   String
  description            String
  status                 HomeStatus       @default(DRAFT)
  careLevel              CareLevel[]
  capacity               Int
  currentOccupancy       Int              @default(0)
  genderRestriction      String?
  priceMin               Decimal?         @db.Decimal(10, 2)
  priceMax               Decimal?         @db.Decimal(10, 2)
  amenities              String[]
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  aiGeneratedDescription String?
  highlights             String[]         @default([])
  lastProfileGenerated   DateTime?
  slug                   String?          @unique
  address                Address?
  operator               Operator         @relation(fields: [operatorId], references: [id], onDelete: Cascade)
  bookings               Booking[]
  caregiverShifts        CaregiverShift[]
  favorites              FavoriteHome[]
  photos                 HomePhoto[]
  reviews                HomeReview[]
  inquiries              Inquiry[]
  inspections            Inspection[]
  licenses               License[]
  matchFeedback          MatchFeedback[]
  matchResults           MatchResult[]
  residents              Resident[]
  tourRequests           TourRequest[]
  tourSlots              TourSlot[]
  placementRequests      PlacementRequest[]

  @@index([operatorId])
  @@index([status])
  @@index([priceMin, priceMax])
  @@index([careLevel])
  @@index([lastProfileGenerated])
}

model HomePhoto {
  id        String             @id @default(cuid())
  homeId    String
  url       String
  caption   String?
  isPrimary Boolean            @default(false)
  sortOrder Int                @default(0)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  home      AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)

  @@index([homeId])
}

model Address {
  id        String              @id @default(cuid())
  street    String
  street2   String?
  city      String
  state     String
  zipCode   String
  country   String              @default("USA")
  latitude  Float?
  longitude Float?
  userId    String?
  homeId    String?             @unique
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  home      AssistedLivingHome? @relation(fields: [homeId], references: [id])
  user      User?               @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([homeId])
  @@index([city, state])
  @@index([zipCode])
  @@index([latitude, longitude])
}

model Resident {
  id                   String                   @id @default(cuid())
  familyId             String
  homeId               String?
  firstName            String
  lastName             String
  dateOfBirth          DateTime
  gender               String
  status               ResidentStatus           @default(INQUIRY)
  careNeeds            Json?
  medicalConditions    String?
  medications          String?
  notes                String?
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime                 @updatedAt
  admissionDate        DateTime?
  dischargeDate        DateTime?
  archivedAt           DateTime?
  allergies            String?
  dietaryRestrictions  String?
  photoUrl             String?
  assessmentResults    AssessmentResult[]
  bookings             Booking[]
  careTimeline         CareTimelineEvent[]
  caregiverAssignments CaregiverAssignment[]
  documents            Document[]
  emergencyPreferences EmergencyPreference[]
  familyContacts       FamilyContact[]
  familyDocuments      FamilyDocument[]
  familyNotes          FamilyNote[]
  sourceInquiry        Inquiry?                 @relation("ConvertedFromInquiry")
  family               Family                   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  home                 AssistedLivingHome?      @relation(fields: [homeId], references: [id])
  complianceItems      ResidentComplianceItem[]
  contacts             ResidentContact[]
  residentDocuments    ResidentDocument[]
  residentIncidents    ResidentIncident[]
  residentNotes        ResidentNote[]

  @@index([familyId])
  @@index([homeId])
  @@index([status])
  @@index([archivedAt])
}

/// Documents uploaded for residents (medical records, care plans, etc.)
model ResidentDocument {
  id           String               @id @default(cuid())
  residentId   String
  documentType ResidentDocumentType
  fileName     String
  fileUrl      String
  fileType     String
  fileSize     Int
  description  String?
  uploadedById String
  uploadedAt   DateTime             @default(now())
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  resident     Resident             @relation(fields: [residentId], references: [id], onDelete: Cascade)
  uploadedBy   User                 @relation("ResidentDocumentUploader", fields: [uploadedById], references: [id])

  @@index([residentId])
  @@index([documentType])
  @@index([uploadedById])
  @@index([uploadedAt])
}

/// Primary and secondary contacts for a resident (e.g., family members, care proxy)
model ResidentContact {
  id           String   @id @default(cuid())
  residentId   String
  name         String
  relationship String?
  email        String?
  phone        String?
  isPrimary    Boolean  @default(false)
  preferences  Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  resident     Resident @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@unique([residentId, email])
  @@index([residentId])
  @@index([isPrimary])
}

model ResidentComplianceItem {
  id          String            @id @default(cuid())
  residentId  String
  type        String
  title       String
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  status      ComplianceStatus? @default(CURRENT)
  issuedDate  DateTime?
  expiryDate  DateTime?
  documentUrl String?
  verifiedBy  String?
  verifiedAt  DateTime?
  resident    Resident          @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@index([residentId])
  @@index([expiryDate])
  @@index([type])
}

/// Family contacts for resident - beyond emergency contacts (communication, permissions, visits)
model FamilyContact {
  id                String    @id @default(cuid())
  residentId        String
  name              String
  relationship      String
  phone             String?
  email             String?
  address           String?
  isPrimaryContact  Boolean   @default(false)
  permissionLevel   String    @default("VIEW_ONLY")
  contactPreference String?   @default("PHONE")
  notes             String?
  lastContactDate   DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @default(now()) @updatedAt
  resident          Resident  @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@index([residentId])
  @@index([isPrimaryContact])
  @@index([permissionLevel])
}

model CareTimelineEvent {
  id          String    @id @default(cuid())
  residentId  String
  eventType   String
  title       String
  description String?
  scheduledAt DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  resident    Resident  @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@index([residentId])
  @@index([eventType])
  @@index([scheduledAt])
}

/// Clinical assessment results recorded for a resident
model AssessmentResult {
  id              String   @id @default(cuid())
  residentId      String
  type            String
  score           Int?
  data            Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  status          String?
  conductedBy     String?
  conductedAt     DateTime @default(now())
  notes           String?
  recommendations String?
  resident        Resident @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@index([residentId])
  @@index([createdAt])
  @@index([conductedAt])
  @@index([type])
  @@index([status])
}

/// Incident reports associated with a resident
model ResidentIncident {
  id               String    @id @default(cuid())
  residentId       String
  type             String
  severity         String
  occurredAt       DateTime
  description      String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  status           String    @default("REPORTED")
  location         String?
  reportedBy       String?
  reportedAt       DateTime  @default(now())
  witnessedBy      String?
  actionsTaken     String?
  followUpRequired Boolean   @default(false)
  resolutionNotes  String?
  resolvedAt       DateTime?
  resolvedBy       String?
  resident         Resident  @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@index([residentId])
  @@index([occurredAt])
  @@index([type])
  @@index([severity])
  @@index([status])
  @@index([reportedAt])
}

/// Free-form notes on a resident with role-based visibility
model ResidentNote {
  id              String         @id @default(cuid())
  residentId      String
  visibility      NoteVisibility @default(INTERNAL)
  content         String
  createdByUserId String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  createdBy       User?          @relation(fields: [createdByUserId], references: [id])
  resident        Resident       @relation(fields: [residentId], references: [id], onDelete: Cascade)

  @@index([residentId])
  @@index([createdByUserId])
  @@index([visibility])
}

model Inquiry {
  id                     String             @id @default(cuid())
  familyId               String
  homeId                 String
  status                 InquiryStatus      @default(NEW)
  message                String?
  tourDate               DateTime?
  aiMatchScore           Float?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  /// Operator-internal notes for this lead (not visible to families)
  internalNotes          String?
  convertedToResidentId  String?            @unique
  conversionDate         DateTime?
  convertedByUserId      String?
  conversionNotes        String?
  contactName            String?
  contactEmail           String?
  contactPhone           String?
  careRecipientName      String?
  careRecipientAge       Int?
  careNeeds              String[]           @default([])
  additionalInfo         String?
  urgency                InquiryUrgency?    @default(MEDIUM)
  source                 InquirySource?     @default(WEBSITE)
  preferredContactMethod ContactMethod?     @default(EMAIL)
  assignedToId           String?
  booking                Booking?
  uploadedDocuments      Document[]         @relation("uploadedDocuments")
  followUps              FollowUp[]
  assignedTo             User?              @relation("AssignedInquiries", fields: [assignedToId], references: [id])
  convertedBy            User?              @relation("InquiryConverter", fields: [convertedByUserId], references: [id])
  convertedResident      Resident?          @relation("ConvertedFromInquiry", fields: [convertedToResidentId], references: [id])
  family                 Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)
  home                   AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)
  documents              InquiryDocument[]
  responses              InquiryResponse[]

  @@index([familyId])
  @@index([homeId])
  @@index([status])
  @@index([tourDate])
  @@index([convertedToResidentId])
  @@index([convertedByUserId])
  @@index([conversionDate])
  @@index([assignedToId])
  @@index([urgency])
  @@index([source])
  @@index([createdAt])
}

/// Documents associated with an inquiry (applications, IDs, medical records, etc.)
model InquiryDocument {
  id           String   @id @default(cuid())
  inquiryId    String
  fileName     String
  fileUrl      String
  fileType     String
  documentType String
  description  String?
  fileSize     Int
  uploadedById String
  uploadedAt   DateTime @default(now())
  inquiry      Inquiry  @relation(fields: [inquiryId], references: [id], onDelete: Cascade)
  uploadedBy   User     @relation("InquiryDocumentUploader", fields: [uploadedById], references: [id])

  @@index([inquiryId])
  @@index([uploadedById])
  @@index([documentType])
  @@index([uploadedAt])
}

/// Tracks all responses sent for an inquiry (AI-generated, manual, or automated)
model InquiryResponse {
  id        String          @id @default(cuid())
  inquiryId String
  content   String
  type      ResponseType    @default(AI_GENERATED)
  channel   ResponseChannel @default(EMAIL)
  sentBy    String?
  sentAt    DateTime?
  status    ResponseStatus  @default(DRAFT)
  metadata  Json?
  subject   String?
  toAddress String?
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  inquiry   Inquiry         @relation(fields: [inquiryId], references: [id], onDelete: Cascade)

  @@index([inquiryId])
  @@index([type])
  @@index([channel])
  @@index([status])
  @@index([sentAt])
  @@index([createdAt])
}

/// Scheduled follow-up communications for inquiries
model FollowUp {
  id           String         @id @default(cuid())
  inquiryId    String
  scheduledFor DateTime
  type         FollowUpType   @default(EMAIL)
  subject      String?
  content      String?
  status       FollowUpStatus @default(PENDING)
  completedAt  DateTime?
  completedBy  String?
  metadata     Json?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  inquiry      Inquiry        @relation(fields: [inquiryId], references: [id], onDelete: Cascade)

  @@index([inquiryId])
  @@index([scheduledFor])
  @@index([status])
  @@index([type])
  @@index([createdAt])
}

/// Lead/Inquiry model for Family â†’ Aide/Provider marketplace inquiries
/// Uses polymorphic pattern to support both AIDE and PROVIDER targets
model Lead {
  id                   String         @id @default(cuid())
  familyId             String
  targetType           LeadTargetType
  aideId               String?
  providerId           String?
  status               LeadStatus     @default(NEW)
  message              String?
  preferredStartDate   DateTime?
  expectedHoursPerWeek Int?
  location             String?
  operatorNotes        String?
  assignedOperatorId   String?
  deletedAt            DateTime?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  aide                 Caregiver?     @relation("LeadToAide", fields: [aideId], references: [id], onDelete: Cascade)
  assignedOperator     User?          @relation("AssignedLeads", fields: [assignedOperatorId], references: [id])
  family               Family         @relation(fields: [familyId], references: [id], onDelete: Cascade)
  provider             Provider?      @relation("LeadToProvider", fields: [providerId], references: [id], onDelete: Cascade)

  @@index([familyId])
  @@index([targetType])
  @@index([aideId])
  @@index([providerId])
  @@index([status])
  @@index([assignedOperatorId])
  @@index([createdAt])
  @@index([deletedAt])
}

model Booking {
  id          String             @id @default(cuid())
  familyId    String
  homeId      String
  residentId  String
  inquiryId   String?            @unique
  status      BookingStatus      @default(PENDING)
  moveInDate  DateTime
  moveOutDate DateTime?
  deposit     Decimal?           @db.Decimal(10, 2)
  monthlyRate Decimal            @db.Decimal(10, 2)
  notes       String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  family      Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)
  home        AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)
  inquiry     Inquiry?           @relation(fields: [inquiryId], references: [id])
  resident    Resident           @relation(fields: [residentId], references: [id], onDelete: Cascade)
  payments    Payment[]

  @@index([familyId])
  @@index([homeId])
  @@index([residentId])
  @@index([status])
  @@index([moveInDate])
}

model Credential {
  id             String    @id @default(cuid())
  caregiverId    String
  type           String
  documentUrl    String?
  issueDate      DateTime
  expirationDate DateTime
  isVerified     Boolean   @default(false)
  verifiedBy     String?
  verifiedAt     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  caregiver      Caregiver @relation(fields: [caregiverId], references: [id], onDelete: Cascade)

  @@index([caregiverId])
  @@index([type])
  @@index([expirationDate])
}

model CaregiverEmployment {
  id          String    @id @default(cuid())
  caregiverId String
  operatorId  String
  startDate   DateTime
  endDate     DateTime?
  position    String
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  caregiver   Caregiver @relation(fields: [caregiverId], references: [id], onDelete: Cascade)
  operator    Operator  @relation(fields: [operatorId], references: [id], onDelete: Cascade)

  @@index([caregiverId])
  @@index([operatorId])
  @@index([isActive])
}

model CaregiverShift {
  id              String             @id @default(cuid())
  homeId          String
  caregiverId     String?
  startTime       DateTime
  endTime         DateTime
  status          ShiftStatus        @default(OPEN)
  hourlyRate      Decimal            @db.Decimal(10, 2)
  notes           String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  caregiver       Caregiver?         @relation(fields: [caregiverId], references: [id])
  home            AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)
  marketplaceHire MarketplaceHire?   @relation("ShiftHire")
  timesheet       Timesheet?         @relation("ShiftTimesheet")

  @@index([homeId])
  @@index([caregiverId])
  @@index([startTime])
  @@index([status])
}

model Timesheet {
  id           String          @id @default(cuid())
  shiftId      String          @unique
  caregiverId  String
  startTime    DateTime
  endTime      DateTime?
  breakMinutes Int             @default(0)
  status       TimesheetStatus @default(DRAFT)
  notes        String?
  approvedById String?
  approvedAt   DateTime?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  approvedBy   User?           @relation(fields: [approvedById], references: [id])
  caregiver    Caregiver       @relation(fields: [caregiverId], references: [id], onDelete: Cascade)
  shift        CaregiverShift  @relation("ShiftTimesheet", fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([caregiverId])
  @@index([status])
  @@index([createdAt])
}

model HomeReview {
  id         String             @id @default(cuid())
  homeId     String
  reviewerId String
  rating     Int
  title      String?
  content    String?
  isPublic   Boolean            @default(true)
  isVerified Boolean            @default(false)
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
  home       AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)

  @@index([homeId])
  @@index([rating])
}

model CaregiverReview {
  id          String    @id @default(cuid())
  caregiverId String
  reviewerId  String
  rating      Int
  title       String?
  content     String?
  isPublic    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  caregiver   Caregiver @relation(fields: [caregiverId], references: [id], onDelete: Cascade)

  @@index([caregiverId])
  @@index([rating])
}

model Payment {
  id                   String              @id @default(cuid())
  userId               String
  bookingId            String?
  amount               Decimal             @db.Decimal(10, 2)
  status               PaymentStatus       @default(PENDING)
  type                 PaymentType
  description          String?
  stripePaymentId      String?             @unique
  receiptUrl           String?
  marketplaceListingId String?
  marketplaceHireId    String?             @unique
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  booking              Booking?            @relation(fields: [bookingId], references: [id])
  marketplaceHire      MarketplaceHire?    @relation(fields: [marketplaceHireId], references: [id])
  marketplaceListing   MarketplaceListing? @relation(fields: [marketplaceListingId], references: [id])
  user                 User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([bookingId])
  @@index([status])
  @@index([type])
  @@index([marketplaceListingId])
}

model FamilyWallet {
  id               String              @id @default(cuid())
  familyId         String              @unique
  balance          Decimal             @default(0) @db.Decimal(10, 2)
  stripeCustomerId String?             @unique
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  family           Family              @relation(fields: [familyId], references: [id], onDelete: Cascade)
  transactions     WalletTransaction[]

  @@index([familyId])
}

model WalletTransaction {
  id          String          @id @default(cuid())
  walletId    String
  amount      Decimal         @db.Decimal(10, 2)
  type        TransactionType
  description String?
  createdAt   DateTime        @default(now())
  wallet      FamilyWallet    @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([walletId])
  @@index([type])
}

model Message {
  id         String        @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  status     MessageStatus @default(SENT)
  createdAt  DateTime      @default(now())
  readAt     DateTime?
  receiver   User          @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User          @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([status])
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  isRead    Boolean          @default(false)
  data      Json?
  createdAt DateTime         @default(now())
  readAt    DateTime?
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([isRead])
}

model License {
  id             String             @id @default(cuid())
  homeId         String
  type           String
  licenseNumber  String
  issueDate      DateTime
  expirationDate DateTime
  status         String
  documentUrl    String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  home           AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)

  @@index([homeId])
  @@index([expirationDate])
  @@index([status])
}

model Inspection {
  id             String             @id @default(cuid())
  homeId         String
  inspectionDate DateTime
  inspectionType String
  inspector      String
  result         String
  findings       String?
  documentUrl    String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  home           AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)

  @@index([homeId])
  @@index([inspectionDate])
  @@index([result])
}

model AffiliateReferral {
  id               String    @id @default(cuid())
  affiliateId      String
  referredEmail    String
  referredUserId   String?
  status           String
  conversionDate   DateTime?
  commissionAmount Decimal?  @db.Decimal(10, 2)
  commissionPaid   Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  affiliate        Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([referredEmail])
  @@index([referredUserId])
  @@index([status])
}

model AuditLog {
  id             String      @id @default(cuid())
  userId         String
  actionedBy     String?
  action         AuditAction
  resourceType   String
  resourceId     String?
  description    String
  ipAddress      String?
  userAgent      String?
  metadata       Json?
  createdAt      DateTime    @default(now())
  actionedByUser User?       @relation("ActionedByUser", fields: [actionedBy], references: [id])
  user           User        @relation("UserAuditLogs", fields: [userId], references: [id])

  @@index([userId])
  @@index([actionedBy])
  @@index([action])
  @@index([resourceType, resourceId])
  @@index([createdAt])
}

model FavoriteHome {
  id        String             @id @default(cuid())
  familyId  String
  homeId    String
  notes     String?
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  family    Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)
  home      AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)

  @@unique([familyId, homeId])
  @@index([familyId])
  @@index([homeId])
  @@index([createdAt])
}

model AIMatchingData {
  id          String   @id @default(cuid())
  homeId      String?
  caregiverId String?
  residentId  String?
  matchScore  Float
  matchReason String?
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([homeId])
  @@index([caregiverId])
  @@index([residentId])
  @@index([matchScore])
}

model AIRiskFlag {
  id              String    @id @default(cuid())
  entityType      String
  entityId        String
  riskType        String
  riskScore       Float
  riskReason      String?
  isActive        Boolean   @default(true)
  resolvedAt      DateTime?
  resolvedBy      String?
  resolutionNotes String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([entityType, entityId])
  @@index([riskType])
  @@index([riskScore])
  @@index([isActive])
}

model Appointment {
  id                  String                   @id @default(cuid())
  type                AppointmentType
  status              AppointmentStatus        @default(PENDING)
  title               String
  description         String?
  notes               String?
  startTime           DateTime
  endTime             DateTime
  location            Json?
  homeId              String?
  residentId          String?
  createdById         String
  recurrence          Json?
  reminders           Json?
  customFields        Json?
  metadata            Json?
  parentAppointmentId String?
  createdAt           DateTime                 @default(now())
  updatedAt           DateTime                 @updatedAt
  createdBy           User                     @relation(fields: [createdById], references: [id], onDelete: Cascade)
  parentAppointment   Appointment?             @relation("ParentSeries", fields: [parentAppointmentId], references: [id])
  recurringInstances  Appointment[]            @relation("ParentSeries")
  participants        AppointmentParticipant[]

  @@index([createdById])
  @@index([homeId])
  @@index([residentId])
  @@index([type])
  @@index([status])
  @@index([startTime, endTime])
}

model AppointmentParticipant {
  id            String      @id @default(cuid())
  appointmentId String
  userId        String
  name          String?
  role          UserRole?
  status        String      @default("PENDING")
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([appointmentId])
  @@index([userId])
}

model AvailabilitySlot {
  id           String   @id @default(cuid())
  userId       String
  startTime    DateTime
  endTime      DateTime
  isAvailable  Boolean  @default(true)
  availableFor String[]
  homeId       String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([homeId])
  @@index([startTime, endTime])
}

model ScheduledNotification {
  id           String                      @id @default(cuid())
  userId       String
  type         String
  method       String
  status       ScheduledNotificationStatus @default(PENDING)
  scheduledFor DateTime
  payload      Json
  createdAt    DateTime                    @default(now())
  updatedAt    DateTime                    @updatedAt
  user         User                        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([scheduledFor])
}

model FamilyMember {
  id          String             @id @default(cuid())
  familyId    String
  userId      String
  role        FamilyMemberRole
  status      FamilyMemberStatus @default(PENDING)
  invitedById String?
  invitedAt   DateTime?
  joinedAt    DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  family      Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)
  invitedBy   User?              @relation("InvitedBy", fields: [invitedById], references: [id])
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([familyId])
  @@index([userId])
  @@index([status])
}

model FamilyDocument {
  id          String             @id @default(cuid())
  familyId    String
  uploaderId  String
  residentId  String?
  type        FamilyDocumentType
  title       String
  description String?
  fileUrl     String
  fileName    String
  fileType    String
  fileSize    Int
  version     Int                @default(1)
  isEncrypted Boolean            @default(true)
  acl         Json?
  tags        String[]
  metadata    Json?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  comments    DocumentComment[]
  family      Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)
  resident    Resident?          @relation(fields: [residentId], references: [id])
  uploader    User               @relation("DocumentUploader", fields: [uploaderId], references: [id])

  @@index([familyId])
  @@index([uploaderId])
  @@index([residentId])
  @@index([type])
  @@index([tags])
  @@index([createdAt])
}

model FamilyNote {
  id         String        @id @default(cuid())
  familyId   String
  authorId   String
  residentId String?
  title      String
  content    Json
  tags       String[]
  acl        Json?
  metadata   Json?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  author     User          @relation("NoteAuthor", fields: [authorId], references: [id])
  family     Family        @relation(fields: [familyId], references: [id], onDelete: Cascade)
  resident   Resident?     @relation(fields: [residentId], references: [id])
  comments   NoteComment[]

  @@index([familyId])
  @@index([authorId])
  @@index([residentId])
  @@index([tags])
  @@index([createdAt])
}

model DocumentComment {
  id              String            @id @default(cuid())
  documentId      String
  authorId        String
  content         String
  parentCommentId String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  author          User              @relation("DocumentCommentAuthor", fields: [authorId], references: [id])
  document        FamilyDocument    @relation(fields: [documentId], references: [id], onDelete: Cascade)
  parentComment   DocumentComment?  @relation("CommentReplies", fields: [parentCommentId], references: [id])
  replies         DocumentComment[] @relation("CommentReplies")

  @@index([documentId])
  @@index([authorId])
  @@index([parentCommentId])
}

model NoteComment {
  id              String        @id @default(cuid())
  noteId          String
  authorId        String
  content         String
  parentCommentId String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  author          User          @relation("NoteCommentAuthor", fields: [authorId], references: [id])
  note            FamilyNote    @relation(fields: [noteId], references: [id], onDelete: Cascade)
  parentComment   NoteComment?  @relation("NoteCommentReplies", fields: [parentCommentId], references: [id])
  replies         NoteComment[] @relation("NoteCommentReplies")

  @@index([noteId])
  @@index([authorId])
  @@index([parentCommentId])
}

model SharedGallery {
  id            String         @id @default(cuid())
  familyId      String
  creatorId     String
  title         String
  description   String?
  coverPhotoUrl String?
  acl           Json?
  tags          String[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  photos        GalleryPhoto[]
  creator       User           @relation("GalleryCreator", fields: [creatorId], references: [id])
  family        Family         @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@index([familyId])
  @@index([creatorId])
  @@index([tags])
  @@index([createdAt])
}

model GalleryPhoto {
  id           String        @id @default(cuid())
  galleryId    String
  uploaderId   String
  fileUrl      String
  thumbnailUrl String
  caption      String?
  metadata     Json?
  sortOrder    Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  gallery      SharedGallery @relation(fields: [galleryId], references: [id], onDelete: Cascade)
  uploader     User          @relation("PhotoUploader", fields: [uploaderId], references: [id])

  @@index([galleryId])
  @@index([uploaderId])
  @@index([createdAt])
}

model ActivityFeedItem {
  id           String       @id @default(cuid())
  familyId     String
  actorId      String
  type         ActivityType
  resourceType String
  resourceId   String?
  description  String
  metadata     Json?
  createdAt    DateTime     @default(now())
  actor        User         @relation("ActivityActor", fields: [actorId], references: [id])
  family       Family       @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@index([familyId])
  @@index([actorId])
  @@index([type])
  @@index([createdAt])
}

/// -----------------------------------------------------
/// Emergency escalation preferences
/// -----------------------------------------------------
model EmergencyPreference {
  id               String    @id @default(cuid())
  familyId         String
  residentId       String?
  escalationChain  Json
  notifyMethods    String[]
  careInstructions String?
  lastConfirmedAt  DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  family           Family    @relation(fields: [familyId], references: [id], onDelete: Cascade)
  resident         Resident? @relation(fields: [residentId], references: [id])

  @@unique([familyId, residentId])
  @@index([familyId])
  @@index([residentId])
}

model MarketplaceCategory {
  id        String       @id @default(cuid())
  name      String
  slug      String       @unique
  type      CategoryType
  sortOrder Int          @default(0)
  isActive  Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@index([type])
  @@index([isActive])
}

model MarketplaceListing {
  id             String                   @id @default(cuid())
  postedByUserId String
  title          String
  description    String
  hourlyRateMin  Decimal?                 @db.Decimal(10, 2)
  hourlyRateMax  Decimal?                 @db.Decimal(10, 2)
  setting        String?
  careTypes      String[]
  services       String[]
  specialties    String[]
  city           String?
  state          String?
  zipCode        String?
  latitude       Float?
  longitude      Float?
  startTime      DateTime?
  endTime        DateTime?
  status         MarketplaceListingStatus @default(OPEN)
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  favoritedBy    FavoriteListing[]
  applications   MarketplaceApplication[]
  hires          MarketplaceHire[]
  postedBy       User                     @relation("UserListings", fields: [postedByUserId], references: [id], onDelete: Cascade)
  payments       Payment[]

  @@index([postedByUserId])
  @@index([status])
  @@index([createdAt])
  @@index([city, state])
  @@index([zipCode])
}

model MarketplaceApplication {
  id          String             @id @default(cuid())
  listingId   String
  caregiverId String
  status      ApplicationStatus  @default(APPLIED)
  note        String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  caregiver   Caregiver          @relation(fields: [caregiverId], references: [id], onDelete: Cascade)
  listing     MarketplaceListing @relation(fields: [listingId], references: [id], onDelete: Cascade)
  hire        MarketplaceHire?   @relation("ApplicationHire")

  @@unique([listingId, caregiverId])
  @@index([listingId])
  @@index([caregiverId])
  @@index([status])
}

model MarketplaceHire {
  id            String                  @id @default(cuid())
  listingId     String?
  caregiverId   String
  applicationId String?                 @unique
  shiftId       String?                 @unique
  acceptedAt    DateTime                @default(now())
  createdAt     DateTime                @default(now())
  application   MarketplaceApplication? @relation("ApplicationHire", fields: [applicationId], references: [id])
  caregiver     Caregiver               @relation(fields: [caregiverId], references: [id], onDelete: Cascade)
  listing       MarketplaceListing?     @relation(fields: [listingId], references: [id], onDelete: Cascade)
  shift         CaregiverShift?         @relation("ShiftHire", fields: [shiftId], references: [id])
  payment       Payment?

  @@index([listingId])
  @@index([caregiverId])
  @@index([applicationId])
  @@index([shiftId])
}

/// Favorites for marketplace listings (per caregiver)
model FavoriteListing {
  id          String             @id @default(cuid())
  caregiverId String
  listingId   String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  caregiver   Caregiver          @relation(fields: [caregiverId], references: [id], onDelete: Cascade)
  listing     MarketplaceListing @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([caregiverId, listingId])
  @@index([caregiverId])
  @@index([listingId])
}

/// Families can favorite Caregivers to build shortlists
model FavoriteCaregiver {
  id          String    @id @default(cuid())
  familyId    String
  caregiverId String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  caregiver   Caregiver @relation(fields: [caregiverId], references: [id], onDelete: Cascade)
  family      Family    @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@unique([familyId, caregiverId])
  @@index([familyId])
  @@index([caregiverId])
}

/// Families can favorite Providers to build shortlists
model FavoriteProvider {
  id         String   @id @default(cuid())
  familyId   String
  providerId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  family     Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  provider   Provider @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@unique([familyId, providerId])
  @@index([familyId])
  @@index([providerId])
}

model Report {
  id          String       @id @default(cuid())
  title       String
  type        ReportType
  format      ReportFormat
  fileUrl     String?
  config      Json
  generatedBy String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  user        User         @relation("ReportGenerator", fields: [generatedBy], references: [id])

  @@index([generatedBy])
  @@index([type])
  @@index([createdAt])
}

model ScheduledReport {
  id         String         @id @default(cuid())
  title      String
  type       ReportType
  format     ReportFormat   @default(PDF)
  schedule   ReportSchedule
  dayOfWeek  Int?
  dayOfMonth Int?
  time       String
  recipients String[]
  config     Json
  enabled    Boolean        @default(true)
  lastRun    DateTime?
  nextRun    DateTime?
  createdBy  String
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  user       User           @relation("ScheduledReportCreator", fields: [createdBy], references: [id])

  @@index([createdBy])
  @@index([enabled])
  @@index([nextRun])
  @@index([type])
}

model MatchRequest {
  id                String          @id @default(cuid())
  familyId          String
  status            MatchStatus     @default(PENDING)
  budgetMin         Decimal         @db.Decimal(10, 2)
  budgetMax         Decimal         @db.Decimal(10, 2)
  medicalConditions String[]        @default([])
  careLevel         String
  preferredGender   String?
  religion          String?
  dietaryNeeds      String[]        @default([])
  hobbies           String[]        @default([])
  petPreferences    String?
  zipCode           String
  maxDistance       Int
  moveInTimeline    String
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  feedback          MatchFeedback[]
  family            Family          @relation(fields: [familyId], references: [id], onDelete: Cascade)
  results           MatchResult[]

  @@index([familyId])
  @@index([status])
  @@index([createdAt])
}

model MatchResult {
  id             String             @id @default(cuid())
  matchRequestId String
  homeId         String
  fitScore       Decimal            @db.Decimal(5, 2)
  matchFactors   Json
  explanation    String
  rank           Int
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  home           AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)
  matchRequest   MatchRequest       @relation(fields: [matchRequestId], references: [id], onDelete: Cascade)

  @@index([matchRequestId])
  @@index([homeId])
  @@index([fitScore])
  @@index([rank])
}

model MatchFeedback {
  id             String             @id @default(cuid())
  matchRequestId String
  homeId         String
  feedbackType   FeedbackType
  notes          String?
  userId         String
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  home           AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)
  matchRequest   MatchRequest       @relation(fields: [matchRequestId], references: [id], onDelete: Cascade)
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([matchRequestId])
  @@index([homeId])
  @@index([userId])
  @@index([feedbackType])
}

model TourRequest {
  id                 String             @id @default(cuid())
  familyId           String
  homeId             String
  operatorId         String
  requestedTimes     Json
  aiSuggestedTimes   Json?
  confirmedTime      DateTime?
  status             TourStatus         @default(PENDING)
  outcome            TourOutcome?
  familyNotes        String?
  operatorNotes      String?
  cancelledAt        DateTime?
  cancelledBy        String?
  cancellationReason String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  family             Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)
  home               AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)
  operator           Operator           @relation(fields: [operatorId], references: [id], onDelete: Cascade)

  @@index([familyId])
  @@index([homeId])
  @@index([operatorId])
  @@index([status])
  @@index([confirmedTime])
  @@index([createdAt])
}

model TourSlot {
  id        String             @id @default(cuid())
  homeId    String
  dayOfWeek Int
  startTime String
  endTime   String
  capacity  Int                @default(1)
  isActive  Boolean            @default(true)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  home      AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)

  @@index([homeId])
  @@index([dayOfWeek])
  @@index([isActive])
}

model Document {
  id                       String           @id @default(cuid())
  residentId               String?
  type                     DocumentType
  title                    String
  description              String?
  fileUrl                  String
  fileType                 String
  fileSize                 Int
  isEncrypted              Boolean          @default(true)
  createdAt                DateTime         @default(now())
  updatedAt                DateTime         @updatedAt
  category                 String?
  fileName                 String?
  mimeType                 String?
  extractedText            String?
  extractedData            Json?
  extractionStatus         ExtractionStatus @default(PENDING)
  extractionError          String?
  isRequired               Boolean?         @default(false)
  expirationDate           DateTime?
  complianceStatus         ComplianceStatus @default(PENDING)
  inquiryId                String?
  uploadedById             String?
  tags                     String[]         @default([])
  notes                    String?
  version                  Int?             @default(1)
  classificationConfidence Float?
  classificationReasoning  String?
  autoClassified           Boolean          @default(false)
  validationStatus         ValidationStatus @default(PENDING)
  validationErrors         Json?
  reviewStatus             ReviewStatus     @default(NOT_REQUIRED)
  reviewedById             String?
  reviewedAt               DateTime?
  inquiry                  Inquiry?         @relation("uploadedDocuments", fields: [inquiryId], references: [id], onDelete: Cascade)
  resident                 Resident?        @relation(fields: [residentId], references: [id])
  reviewedBy               User?            @relation("DocumentReviewer", fields: [reviewedById], references: [id])
  uploadedBy               User?            @relation("UploadedDocuments", fields: [uploadedById], references: [id], onDelete: Restrict)

  @@index([residentId])
  @@index([inquiryId])
  @@index([type])
  @@index([complianceStatus])
  @@index([uploadedById])
  @@index([expirationDate])
  @@index([validationStatus])
  @@index([reviewStatus])
  @@index([reviewedById])
  @@index([autoClassified])
  @@index([extractionStatus])
}

model DocumentTemplate {
  id          String       @id @default(cuid())
  name        String
  description String?
  type        DocumentType
  template    Json
  fields      Json
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([type])
  @@index([isActive])
}

/// Discharge planner AI placement search
model PlacementSearch {
  id                 String             @id @default(cuid())
  userId             String
  queryText          String             // Natural language query from social worker
  parsedCriteria     Json               // AI-extracted criteria
  searchResults      Json               // Matched homes with scores
  status             PlacementStatus    @default(SEARCHING)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  placementRequests  PlacementRequest[]

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

/// Placement request sent to homes
model PlacementRequest {
  id                  String             @id @default(cuid())
  searchId            String
  homeId              String
  patientInfo         Json               // Patient details, needs, timeline
  status              RequestStatus      @default(PENDING)
  emailSentAt         DateTime?
  emailDeliveryStatus String?
  homeResponse        String?
  homeResponseAt      DateTime?
  notes               String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  search              PlacementSearch    @relation(fields: [searchId], references: [id], onDelete: Cascade)
  home                AssistedLivingHome @relation(fields: [homeId], references: [id], onDelete: Cascade)

  @@index([searchId])
  @@index([homeId])
  @@index([status])
  @@index([createdAt])
}

enum UserRole {
  FAMILY
  OPERATOR
  CAREGIVER
  ADMIN
  AFFILIATE
  STAFF
  PROVIDER
  DISCHARGE_PLANNER
}

enum UserStatus {
  PENDING
  ACTIVE
  SUSPENDED
  DEACTIVATED
}

enum CategoryType {
  SETTING
  CARE_TYPE
  SERVICE
  SPECIALTY
}

enum MarketplaceListingStatus {
  DRAFT
  OPEN
  HIRED
  CLOSED
}

enum ApplicationStatus {
  APPLIED
  INVITED
  INTERVIEWING
  OFFERED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum BackgroundCheckStatus {
  NOT_STARTED
  PENDING
  CLEAR
  CONSIDER
  EXPIRED
  FAILED
}

enum CertificationType {
  CNA
  HHA
  CPR
  FIRST_AID
  MEDICATION_ADMINISTRATION
  DEMENTIA_CARE
  ALZHEIMERS_CARE
  HOSPICE_CARE
  WOUND_CARE
  IV_THERAPY
  OTHER
}

enum CertificationStatus {
  CURRENT
  EXPIRING_SOON
  EXPIRED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  PER_DIEM
  CONTRACT
}

enum EmploymentStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
  TERMINATED
}

enum CaregiverDocumentType {
  CERTIFICATION
  BACKGROUND_CHECK
  TRAINING
  CONTRACT
  IDENTIFICATION
  REFERENCE
  OTHER
}

enum ResidentDocumentType {
  MEDICAL_RECORD
  CARE_PLAN
  INSURANCE
  ADVANCE_DIRECTIVE
  MEDICATION_LIST
  ASSESSMENT_REPORT
  INCIDENT_REPORT
  PHOTO_ID
  EMERGENCY_CONTACT
  OTHER
}

enum CredentialStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

enum HomeStatus {
  DRAFT
  PENDING_REVIEW
  ACTIVE
  SUSPENDED
  INACTIVE
}

enum CareLevel {
  INDEPENDENT
  ASSISTED
  MEMORY_CARE
  SKILLED_NURSING
}

enum ResidentStatus {
  INQUIRY
  PENDING
  ACTIVE
  DISCHARGED
  DECEASED
}

/// Visibility options for resident notes
enum NoteVisibility {
  INTERNAL
  CARE_TEAM
  FAMILY
}

/// Compliance tasks/items tracked per resident (e.g., TB test, flu shot, care plan review)
enum ComplianceStatus {
  CURRENT
  EXPIRING_SOON
  EXPIRED
  NOT_REQUIRED
  PENDING
  COMPLIANT
  MISSING
}

enum InquiryStatus {
  NEW
  CONTACTED
  TOUR_SCHEDULED
  TOUR_COMPLETED
  PLACEMENT_OFFERED
  PLACEMENT_ACCEPTED
  CLOSED_LOST
  QUALIFIED
  CONVERTING
  CONVERTED
}

enum InquiryUrgency {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum InquirySource {
  WEBSITE
  PHONE
  EMAIL
  REFERRAL
  SOCIAL_MEDIA
  WALK_IN
  OTHER
}

enum ContactMethod {
  EMAIL
  PHONE
  SMS
  ANY
}

enum ResponseType {
  AI_GENERATED
  MANUAL
  AUTOMATED
  TEMPLATE
}

enum ResponseChannel {
  EMAIL
  SMS
  PHONE
  IN_APP
}

enum ResponseStatus {
  DRAFT
  SENT
  DELIVERED
  FAILED
  BOUNCED
}

enum FollowUpType {
  EMAIL
  SMS
  PHONE_CALL
  TASK
  REMINDER
}

enum FollowUpStatus {
  PENDING
  SENT
  COMPLETED
  CANCELLED
  OVERDUE
}

enum LeadTargetType {
  AIDE
  PROVIDER
}

enum LeadStatus {
  NEW
  IN_REVIEW
  CONTACTED
  CLOSED
  CANCELLED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELED
  COMPLETED
}

enum ShiftStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELED
  NO_SHOW
}

enum TimesheetStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentType {
  DEPOSIT
  MONTHLY_FEE
  INCIDENTAL
  CAREGIVER_PAYMENT
  AFFILIATE_COMMISSION
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  PAYMENT
  REFUND
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
}

enum NotificationType {
  MESSAGE
  BOOKING
  PAYMENT
  COMPLIANCE
  SYSTEM
}

enum AuditAction {
  CREATE
  READ
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  IMPORT
  ACCESS_DENIED
  OTHER
  REPORT_GENERATED
  REPORT_SCHEDULED
  REPORT_DOWNLOADED
}

/// Appointment-related enums
enum AppointmentType {
  CARE_EVALUATION
  FACILITY_TOUR
  CAREGIVER_SHIFT
  FAMILY_VISIT
  CONSULTATION
  MEDICAL_APPOINTMENT
  ADMIN_MEETING
  SOCIAL_EVENT
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
  RESCHEDULED
}

enum ScheduledNotificationStatus {
  PENDING
  SENT
  CANCELLED
  FAILED
}

enum FamilyMemberRole {
  OWNER
  CARE_PROXY
  MEMBER
  GUEST
}

enum FamilyMemberStatus {
  ACTIVE
  PENDING
  SUSPENDED
}

enum FamilyDocumentType {
  MEDICAL_RECORD
  INSURANCE_DOCUMENT
  PHOTO
  VIDEO
  LEGAL_DOCUMENT
  PERSONAL_DOCUMENT
  OTHER
}

enum ActivityType {
  DOCUMENT_UPLOADED
  DOCUMENT_UPDATED
  DOCUMENT_DELETED
  DOCUMENT_COMMENTED
  NOTE_CREATED
  NOTE_UPDATED
  NOTE_DELETED
  NOTE_COMMENTED
  GALLERY_CREATED
  GALLERY_UPDATED
  PHOTO_UPLOADED
  MEMBER_INVITED
  MEMBER_JOINED
  MEMBER_ROLE_CHANGED
  OTHER
}

enum ReportType {
  OCCUPANCY
  FINANCIAL
  INCIDENT
  CAREGIVER
  COMPLIANCE
  INQUIRY
  RESIDENT
  FACILITY_COMPARISON
  CUSTOM
}

enum ReportFormat {
  PDF
  EXCEL
  CSV
}

enum ReportSchedule {
  DAILY
  WEEKLY
  MONTHLY
}

enum MatchStatus {
  PENDING
  COMPLETED
  FAILED
}

enum FeedbackType {
  THUMBS_UP
  THUMBS_DOWN
  PLACEMENT_CONFIRMED
}

enum TourStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum TourOutcome {
  SHOWED_UP
  NO_SHOW
  CONVERTED
  NOT_CONVERTED
}

enum DocumentType {
  MEDICAL_RECORD
  INSURANCE
  IDENTIFICATION
  FINANCIAL
  LEGAL
  ASSESSMENT_FORM
  EMERGENCY_CONTACT
  GENERAL
}

enum ExtractionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum ValidationStatus {
  PENDING
  VALID
  INVALID
  NEEDS_REVIEW
}

enum ReviewStatus {
  NOT_REQUIRED
  PENDING_REVIEW
  REVIEWED
}

enum PlacementStatus {
  SEARCHING
  COMPLETED
  CANCELLED
}

enum RequestStatus {
  PENDING
  SENT
  VIEWED
  RESPONDED
  ACCEPTED
  DECLINED
}
